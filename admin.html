<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>KornDog Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* --- SAME STYLES YOU HAD (UNCHANGED) --- */
:root{
  --bg:#050013; --bg2:#2a0a60; --card:#12052b; --border:#2b1550;
  --text:#f5f5ff; --muted:#a1a1c5;
  --accent:#7bff5a; --accent2:#7ef7ff; --danger:#ff4b6a;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;min-height:100vh;color:var(--text);
  background:radial-gradient(circle at top,var(--bg2),var(--bg) 60%);
}
.section{
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.1);
  border-radius:18px;padding:16px;margin-bottom:20px;
}
.section-title{
  color:var(--accent2);letter-spacing:.12em;
  text-transform:uppercase;font-size:.9rem;margin-bottom:10px;
}
input,select,textarea{
  width:100%;padding:10px;border-radius:999px;
  background:#050013;border:1px solid rgba(255,255,255,.2);
  color:var(--text)
}
textarea{border-radius:12px}
.btn{
  padding:10px 16px;border-radius:999px;
  border:none;font-weight:800;cursor:pointer
}
.btn-primary{background:var(--accent);color:#000}
.btn-outline{background:transparent;border:1px solid var(--accent);color:var(--accent)}
.btn-danger{background:var(--danger);color:#fff}
.inv-card{
  display:flex;gap:12px;padding:12px;
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;background:rgba(0,0,0,.25)
}
.inv-card img{width:80px;height:80px;border-radius:10px;object-fit:cover}
.badge{padding:4px 10px;border-radius:999px;font-size:.7rem}
.live{border:1px solid var(--accent);color:var(--accent)}
.hidden{border:1px solid var(--danger);color:var(--danger)}
</style>
</head>

<body>
<main style="max-width:1100px;margin:auto;padding:20px">

<h1>KornDog Admin</h1>
<p style="color:var(--muted)">Whatnot-style · GitHub-powered · products.json2 only</p>

<!-- SECTION 1 -->
<div class="section">
  <div class="section-title">1. GitHub Token</div>
  <input id="token" placeholder="Paste GitHub token" />
  <button class="btn btn-outline" onclick="saveToken()">Save Token</button>
  <div id="status"></div>
</div>

<!-- SECTION 2 -->
<div class="section">
  <div class="section-title">2. Add / Edit Record</div>

  <input id="id" placeholder="unique-id-no-spaces" />
  <input id="artist" placeholder="Artist" />
  <input id="title" placeholder="Title" />
  <input id="price" type="number" placeholder="Price" />
  <input id="grade" placeholder="NM/NM" />
  <input id="qty" type="number" value="1" />
  <textarea id="desc" placeholder="Description"></textarea>

  <input id="front" type="file" />
  <input id="back" type="file" />

  <button class="btn btn-primary" onclick="saveRecord()">Save Record</button>
</div>

<!-- SECTION 3 -->
<div class="section">
  <div class="section-title">3. Hide / Show</div>
  <input id="toggleSearch" placeholder="Search title / artist" />
  <button class="btn btn-danger" onclick="setVisibility(false)">Hide</button>
  <button class="btn btn-outline" onclick="setVisibility(true)">Show</button>
</div>

<!-- SECTION 4 -->
<div class="section">
  <div class="section-title">4. Live Inventory</div>
  <div id="inventory"></div>
</div>

</main>

<script>
/* ==============================
   CONFIG
================================*/
const OWNER="KornDog0804";
const REPO="korndog-records-site";
const BRANCH="main";
const PRODUCTS_PATH="products.json2";
const IMG_DIR="images";
const TOKEN_KEY="korndog_github_token";

let products=[], sha=null;

/* ==============================
   CORE
================================*/
function getToken(){
  const t=localStorage.getItem(TOKEN_KEY);
  if(!t) throw "No token set";
  return t;
}
function saveToken(){
  localStorage.setItem(TOKEN_KEY,token.value.trim());
  loadProducts();
}
async function gh(path,opts={}){
  const res=await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`,
    { ...opts,
      headers:{
        Authorization:`token ${getToken()}`,
        Accept:"application/vnd.github+json",
        ...opts.headers
      }
    }
  );
  if(!res.ok) throw await res.text();
  return res.json();
}
async function loadProducts(){
  const f=await gh(PRODUCTS_PATH);
  sha=f.sha;
  products=JSON.parse(atob(f.content));
  renderInventory();
}

/* ==============================
   INVENTORY
================================*/
function renderInventory(){
  inventory.innerHTML="";
  products.forEach(p=>{
    const div=document.createElement("div");
    div.className="inv-card";
    div.innerHTML=`
      <img src="${p.imageFront||""}">
      <div style="flex:1">
        <b>${p.artist} – ${p.title}</b><br>
        $${p.price} · Qty ${p.quantity}
        <div class="badge ${p.available!==false?"live":"hidden"}">
          ${p.available!==false?"LIVE":"HIDDEN"}
        </div>
      </div>
    `;
    inventory.appendChild(div);
  });
}

/* ==============================
   SAVE RECORD
================================*/
async function saveRecord(){
  const idVal=id.value.trim();
  if(!idVal) return alert("ID required");

  const rec={
    id:idVal,
    artist:artist.value,
    title:title.value,
    price:+price.value,
    grade:grade.value,
    quantity:+qty.value||1,
    available:true,
    description:desc.value
  };

  const i=products.findIndex(p=>p.id===idVal);
  if(i>=0) products[i]={...products[i],...rec};
  else products.push(rec);

  await gh(PRODUCTS_PATH,{
    method:"PUT",
    body:JSON.stringify({
      message:`Update ${idVal}`,
      content:btoa(JSON.stringify(products,null,2)),
      sha,branch:BRANCH
    })
  });
  loadProducts();
}

/* ==============================
   VISIBILITY
================================*/
function setVisibility(show){
  const q=toggleSearch.value.toLowerCase();
  products.forEach(p=>{
    if(`${p.artist} ${p.title}`.toLowerCase().includes(q)){
      p.available=show;
    }
  });
  saveAll("Toggle visibility");
}
async function saveAll(msg){
  await gh(PRODUCTS_PATH,{
    method:"PUT",
    body:JSON.stringify({
      message:msg,
      content:btoa(JSON.stringify(products,null,2)),
      sha,branch:BRANCH
    })
  });
  loadProducts();
}

/* INIT */
loadProducts().catch(()=>{});
</script>
</body>
</html>
