<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KornDog Admin â€” Mark Sold</title>

<style>
body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0620; color:#eae6ff; }
.wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
.card { background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12); border-radius:16px; padding:16px; }
h1 { margin: 0 0 10px; font-size: 22px; }
.row { display:flex; gap:10px; flex-wrap:wrap; margin: 12px 0; }
button { cursor:pointer; border:0; border-radius: 12px; padding: 10px 12px; font-weight: 700; }
.btn { background:#7bff5a; color:#0b0620; }
.btn2 { background: transparent; color:#7bff5a; border:1px solid rgba(123,255,90,0.6); }
.btnDanger { background:#ff4d4d; color:#14060a; }
input { padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,0.18); background: rgba(0,0,0,0.25); color:#eae6ff; }
table { width:100%; border-collapse: collapse; margin-top: 10px; }
th, td { text-align:left; padding:10px; border-bottom:1px solid rgba(255,255,255,0.10); vertical-align: top; }
th { font-size: 12px; letter-spacing: .06em; text-transform: uppercase; opacity: .8; }
.pill { display:inline-block; padding:4px 10px; border-radius:999px; font-weight:800; font-size:12px; }
.ok { background: rgba(123,255,90,0.18); color:#7bff5a; border:1px solid rgba(123,255,90,0.35); }
.sold { background: rgba(255,77,77,0.18); color:#ff7a7a; border:1px solid rgba(255,77,77,0.35); }
.small { opacity:.85; font-size: 13px; line-height: 1.4; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; white-space: pre-wrap; }
.topbar { display:flex; align-items:center; justify-content:space-between; }
</style>
</head>

<body>
<div class="wrap">
<div class="card">
<div class="topbar">
<h1>Korndog Admin â€” Mark Sold</h1>
<span class="small" id="status">Locked</span>
</div>

<div id="lockBox">
<p class="small">Static admin. Generates a new <b>products.json2</b> for upload.</p>
<div class="row">
<input id="pw" type="password" placeholder="Admin passphrase" />
<button class="btn" id="unlockBtn">Unlock</button>
</div>
</div>

<div id="app" style="display:none;">
<div class="row">
<button class="btn2" id="reloadBtn">Reload</button>
<button class="btn" id="downloadBtn">Download products.json2</button>
<button class="btn2" id="copyBtn">Copy JSON</button>
<button class="btnDanger" id="resetBtn">Reset</button>
</div>

<input id="filter" placeholder="Searchâ€¦" style="width:100%; margin:10px 0;" />
<div class="small" id="counts"></div>

<table>
<thead>
<tr>
<th>Status</th>
<th>Item</th>
<th>Price</th>
<th>Qty</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<pre class="card mono" id="preview"></pre>
</div>
</div>
</div>

<script>
const PRODUCTS_FILE = "./products.json2";

/* ðŸ” PASSWORD IS SET HERE */
const ADMIN_PASSPHRASE = "korndogonly2025";

const LS_KEY = "korndog_admin_products_override_v1";
let products = [];

const $ = id => document.getElementById(id);

const isSold = p => (p.available === false || Number(p.quantity) <= 0);

const normalize = p => ({
  ...p,
  price: Number(p.price || 0),
  quantity: typeof p.quantity === "number" ? p.quantity : 1,
  available: p.available !== false
});

async function loadFresh() {
  const res = await fetch(PRODUCTS_FILE, { cache: "no-store" });
  return (await res.json()).map(normalize);
}

function saveLocal() {
  localStorage.setItem(LS_KEY, JSON.stringify(products, null, 2));
  $("preview").textContent = JSON.stringify(products.slice(0,2), null, 2);
}

function render() {
  const rows = $("rows");
  rows.innerHTML = "";

  const q = $("filter").value.toLowerCase();
  const visible = products.filter(p =>
    `${p.artist} ${p.title} ${p.id}`.toLowerCase().includes(q)
  );

  const sold = products.filter(isSold).length;
  $("counts").textContent = `Total: ${products.length} | Live: ${products.length-sold} | Sold: ${sold}`;

  visible.forEach(p => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${isSold(p) ? '<span class="pill sold">SOLD</span>' : '<span class="pill ok">LIVE</span>'}</td>
      <td><b>${p.artist ? p.artist+" â€” " : ""}${p.title}</b><br><span class="small mono">${p.id}</span></td>
      <td>$${p.price.toFixed(2)}</td>
      <td>${p.quantity}</td>
      <td></td>
    `;

    const actions = tr.lastElementChild;

    const soldBtn = document.createElement("button");
    soldBtn.className = "btnDanger";
    soldBtn.textContent = "Mark Sold";
    soldBtn.onclick = () => {
      p.available = false;
      p.quantity = 0;
      saveLocal();
      render();
    };

    const liveBtn = document.createElement("button");
    liveBtn.className = "btn";
    liveBtn.textContent = "Mark Live";
    liveBtn.style.marginLeft = "6px";
    liveBtn.onclick = () => {
      p.available = true;
      p.quantity = Math.max(1, p.quantity || 1);
      saveLocal();
      render();
    };

    actions.appendChild(soldBtn);
    actions.appendChild(liveBtn);
    rows.appendChild(tr);
  });
}

$("unlockBtn").onclick = async () => {
  if ($("pw").value !== ADMIN_PASSPHRASE) {
    alert("Wrong passphrase");
    return;
  }
  $("lockBox").style.display = "none";
  $("app").style.display = "block";
  products = JSON.parse(localStorage.getItem(LS_KEY)) || await loadFresh();
  saveLocal();
  render();
};

$("downloadBtn").onclick = () => {
  const blob = new Blob([JSON.stringify(products, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "products.json2";
  a.click();
};

$("copyBtn").onclick = async () => {
  await navigator.clipboard.writeText(JSON.stringify(products, null, 2));
  alert("Copied");
};

$("resetBtn").onclick = async () => {
  localStorage.removeItem(LS_KEY);
  products = await loadFresh();
  saveLocal();
  render();
};

$("filter").addEventListener("input", render);
</script>
</body>
</html>
