<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Hand-picked vinyl records, Funkos & collectibles for music lovers. Vinyl therapy always on deck at KornDog Records."/>
  <meta name="theme-color" content="#3b2aa2"/>
  <title>KornDog Records â€¢ Vinyl Therapy & Collectibles</title>
  <link rel="icon" href="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/ChatGPT%20Image%20Aug%2010%2C%202025%2C%2012_07_42%20AM.png"/>
  <script id="paypal-sdk" src="https://www.paypal.com/sdk/js?client-id=test&currency=USD" data-client="REPLACE_WITH_LIVE_CLIENT_ID"></script>
  <style>
    :root{
      --bg1:#3b2aa2;--bg2:#0fa77f;--ink:#eaf4ff;--muted:#b6c2d1;--card:#0b1220;
      --green:hsl(142 76% 36%);--green2:hsl(142 76% 46%);--accent:#ffd166;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Helvetica,Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--ink)}
    a{color:inherit;text-decoration:none}
    .btn{background:#0e1624;border:1px solid #253146;color:#d7e3f4;border-radius:10px;padding:8px 12px;cursor:pointer;transition:all 0.2s}
    .btn:hover{background:#151f31}
    .btn.primary{background:var(--green);border-color:var(--green);color:#fff}
    .btn.primary:hover{background:var(--green2)}
    .btn.ghost{background:transparent;border-color:#38465f}
    .badge{background:#121827;border:1px solid #243041;color:#a3d2ff;border-radius:999px;padding:2px 7px;margin-left:6px}
    .small{font-size:12px;color:#9fb4c9}
    .muted{font-size:12px;color:#9fb4c9}
    .grow{flex:1}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .nav{position:sticky;top:0;z-index:50;background:rgba(11,18,32,.9);backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,.1);padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .nav .brand{display:flex;gap:10px;align-items:center;font-weight:800;color:var(--accent);cursor:pointer}
    .nav .brand img{width:28px;height:28px;border-radius:50%}
    .nav .links{display:flex;gap:10px;align-items:center}
    main{min-height:calc(100vh - 58px)}
    .page{display:none}.page.active{display:block}
    .hero{min-height:78vh;display:grid;place-items:center;text-align:center;padding:24px}
    .hero-logo{width:220px;height:220px;border-radius:50%;background:rgba(255,255,255,.15);
      border:2px solid rgba(255,255,255,.35);backdrop-filter:blur(8px);display:grid;place-items:center;margin-bottom:10px;cursor:pointer}
    .hero-logo img{width:160px;height:160px;object-fit:contain;border-radius:50%}
    .hero h1{font-size:38px;margin:8px 0}
    .sub{color:#dfe9f8;max-width:680px;margin:0 auto 10px}
    .cta{display:flex;gap:8px;justify-content:center;margin:12px 0}
    .features{display:grid;grid-template-columns:repeat(4, minmax(60px,1fr));gap:10px;max-width:480px;margin:20px auto}
    .features .feat{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);
      border-radius:12px;display:grid;place-items:center;padding:10px}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .card{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.1);border-radius:14px;overflow:hidden;transition:transform 0.2s}
    .card:hover{transform:translateY(-2px)}
    .card img{display:block;width:100%;height:180px;object-fit:cover;background:#0b1220}
    .card .pad{padding:12px}
    .store-head{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:20px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{background:#0f1729;border:1px solid #273043;color:#d7e3f4;border-radius:8px;padding:6px 10px;cursor:pointer;transition:all 0.2s}
    .tab.active,.tab:hover{background:#172136}
    .item-title{font-weight:800;margin:8px 0 4px}
    .price{color:#c4e6ff;margin-bottom:10px;font-size:18px;font-weight:600}
    .row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
    .total{font-size:18px;border-top:1px solid #233046;padding-top:8px;margin-top:8px}
    .drawer{position:fixed;top:0;right:-440px;width:440px;max-width:92vw;height:100vh;background:#0c1423;color:#eaf4ff;
      border-left:1px solid #253146;transition:right .28s ease;display:flex;flex-direction:column;z-index:60}
    .drawer.open{right:0}
    .drawer header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #223045}
    .drawer main{flex:1;overflow:auto;padding:12px}
    .cart-item{display:flex;gap:10px;border:1px solid #223045;border-radius:10px;padding:10px;margin-bottom:10px}
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
    .drawer footer{border-top:1px solid #223045;padding:12px}
    .paypal{margin-top:10px}
    .admin{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);display:none;z-index:80}
    .admin.show{display:block}
    .admin-inner{position:absolute;right:0;top:0;width:100%;max-width:980px;height:100%;background:#0b1220;border-left:1px solid #223045;overflow:auto}
    .adm-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #223045}
    .admin-grid{display:grid;grid-template-columns:360px 1fr;gap:12px;padding:12px}
    .admin-card{background:#0e1628;border:1px solid #223145;border-radius:12px;padding:12px}
    .admin-card h3{margin:4px 0 8px}
    label{display:block;font-size:13px;margin:8px 0;color:#cfe0ff}
    input,select,textarea{width:100%;background:#0b1322;border:1px solid #273246;color:#e6f1ff;border-radius:8px;padding:8px;margin-top:6px}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--green)}
    .photo-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:8px 0}
    .ph{background:#0b1322;border:1px solid #273246;border-radius:10px;padding:8px;text-align:center;cursor:pointer}
    .ph:hover{border-color:#38465f}
    .ph img{width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:6px}
    .ph span{font-size:12px;color:#9fb4c9}
    .ph input{display:none}
    #adminList .row{align-items:flex-start;gap:8px;border-bottom:1px solid #1a2332;padding:8px 0}
    .kitty{position:fixed;bottom:18px;left:18px;display:none;align-items:center;gap:10px;z-index:1000}
    .kitty.show{display:flex;animation:fade .2s}
    .kitty img{width:72px;height:72px;border-radius:50%;object-fit:cover;box-shadow:0 6px 20px rgba(0,0,0,.3)}
    .bubble{background:#fff;color:#141a22;border:3px solid #141a22;border-radius:16px;padding:10px 14px;font-weight:800;position:relative}
    .bubble::after{content:'';position:absolute;left:-8px;top:50%;transform:translateY(-50%);border:8px solid transparent;border-right-color:#141a22}

    .about-hero{
      min-height:100vh;
      background:linear-gradient(135deg, #ff006e, #8338ec, #3a86ff);
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .about-hero::before{
      content:'';
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      background-image:url('https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/Screenshot_20250827-140949.png');
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      opacity:0.15;
      z-index:1;
    }
    .about-content{
      position:relative;
      z-index:2;
      max-width:800px;
      padding:40px 20px;
      text-align:center;
    }
    .about-content h2{
      font-size:42px;
      margin-bottom:30px;
      text-shadow:2px 2px 4px rgba(0,0,0,0.3);
    }
    .about-content p{
      font-size:18px;
      line-height:1.6;
      margin-bottom:20px;
      text-shadow:1px 1px 2px rgba(0,0,0,0.3);
    }

    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @media(max-width:860px){
      .admin-grid{grid-template-columns:1fr}
      .cta{flex-direction:column;align-items:center}
      .features{grid-template-columns:repeat(2,1fr)}
      .hero h1{font-size:28px}
      .btn{padding:12px 16px;font-size:16px;min-height:44px}
      .about-content h2{font-size:32px}
      .about-content p{font-size:16px}
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="brand" onclick="KDR.show('home')">
      <img src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/ChatGPT%20Image%20Aug%2010%2C%202025%2C%2012_07_42%20AM.png" alt="KornDog" />
      <span>KornDog Records</span>
    </div>
    <div class="links">
      <a href="#" onclick="KDR.show('home')">Home</a>
      <a href="#" onclick="KDR.show('store')">Shop</a>
      <a href="#" onclick="KDR.show('about')">About</a>
      <button class="btn" id="cartBtn" onclick="KDR.openCart()">Cart <span id="cartCount" class="badge">0</span></button>
    </div>
  </nav>

  <main>
    <section id="home" class="page active">
      <div class="hero">
        <div class="hero-logo" id="zombieTapArea" title="Tap Zombie Kitty 5Ã— for Admin">
          <img src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/Screenshot_20250827-140949.png" alt="Zombie Kitty (tap 5Ã— for Admin)" />
        </div>
        <h1>Vinyl Therapy Always On Deck</h1>
        <p class="sub">Hand-picked records, funkos & collectibles for music lovers and pop culture enthusiasts</p>
        <div class="cta">
          <button class="btn primary" onclick="KDR.show('store')">Enter The Shop</button>
          <button class="btn" onclick="KDR.show('about')">About</button>
        </div>

        <div class="features">
          <div class="feat"><i>ðŸ’½</i><span>Vinyl</span></div>
          <div class="feat"><i>ðŸ’¿</i><span>CDs</span></div>
          <div class="feat"><i>ðŸ¤–</i><span>Funk Pops</span></div>
          <div class="feat"><i>ðŸŽ®</i><span>Collectibles</span></div>
        </div>
      </div>
    </section>

    <section id="store" class="page">
      <div class="container">
        <header class="store-head">
          <h2>Explore Our Collections</h2>
          <div class="tabs">
            <button class="tab active" data-filter="all" onclick="KDR.filter('all', this)">All</button>
            <button class="tab" data-filter="vinyl" onclick="KDR.filter('vinyl', this)">Vinyl</button>
            <button class="tab" data-filter="cd" onclick="KDR.filter('cd', this)">CDs</button>
            <button class="tab" data-filter="funko" onclick="KDR.filter('funko', this)">Funkos</button>
            <button class="tab" data-filter="collectible" onclick="KDR.filter('collectible', this)">Collectibles</button>
          </div>
        </header>
        <div id="grid" class="grid"></div>
      </div>
    </section>

    <section id="about" class="page">
      <div class="about-hero">
        <div class="about-content">
          <h2>About Me (Korndog Records)</h2>
          <p>Music's always been in my blood â€” thanks to my mom and dad â€” but vinyl didn't hit me 'til after my mom's wreck. She didn't make it. That moment split my world in two. Records became therapy. No therapist. No pills. Just needle to groove. It grounded me. Every spin pulls me back â€” riding shotgun with my old man, laughing with my kids, slow dancing with my wife.</p>
          <p>This site? It's not about algorithms, trends, or fake hype. It's about soul. About stories. About memories you can hear. Every record here means something. It's not just wax â€” it's a vibe. A scar. A time machine.</p>
          <p>If you get it, you get it.</p>
          <p>Welcome to Korndog Records â€” where vinyl therapy is always on deck</p>
          
          <h3 style="margin-top:40px;margin-bottom:20px;color:#ff69b4;">Zombie Kitty Story</h3>
          <p>Zombie Kitty isn't just a mascot â€” she's family. She was born out of a Friday the 13th tattoo session with my daughter Elizabeth. Purple rose eye, stitched-up smile â€” part nightmare, part love letter. She's a reminder that scars can be turned into art, that even the broken pieces still tell a story.</p>
          <p>For Korndog Records, Zombie Kitty lives in the grooves. She pops up when the music hits that raw nerve â€” the scratchy edges, the late-night confessions, the songs that refuse to die. Just like her, vinyl never really fades. It comes back to life every time the needle drops.</p>
          
          <div class="cta">
            <button class="btn primary" onclick="KDR.show('store')">Start Your Collection</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <aside id="drawer" class="drawer">
    <header>
      <strong>Your Cart</strong>
      <button class="btn" onclick="KDR.closeCart()">Close</button>
    </header>
    <main id="cartList"></main>
    <footer>
      <div class="row"><span>Subtotal:</span><strong id="subtotal">$0.00</strong></div>
      <div class="row small"><span>Discount:</span><span id="discount">$0.00</span></div>
      <div class="row small"><span>Tax (6%):</span><span id="tax">$0.00</span></div>
      <div class="row total"><span>Total:</span><strong id="grand">$0.00</strong></div>
      <div id="paypal-buttons" class="paypal"></div>
      <button class="btn ghost" onclick="KDR.clearCart()" style="width:100%;margin-top:10px">Clear cart</button>
    </footer>
  </aside>

  <div id="admin" class="admin">
    <div class="admin-inner">
      <div class="adm-head">
        <strong>Admin</strong>
        <button class="btn" onclick="KDR.hideAdmin()">Close</button>
      </div>
      <div class="admin-grid">
        <form id="prodForm" onsubmit="KDR.saveProduct(event)" class="admin-card">
          <h3>Add / Edit Product</h3>
          <label>Title<input id="pTitle" required></label>
          <div class="row2">
            <label>Category
              <select id="pType" required>
                <option value="vinyl">Vinyl</option>
                <option value="cd">CD</option>
                <option value="funko">Funko</option>
                <option value="collectible">Collectible</option>
              </select>
            </label>
            <label>Price ($)
              <input id="pPrice" type="number" step="0.01" required onblur="KDR.snapPrice(this)">
              <small class="muted">Snaps to .99 or .59</small>
            </label>
          </div>

          <div class="photo-grid">
            <div class="ph" onclick="document.getElementById('pFront').click()">
              <img id="prevFront" src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/ChatGPT%20Image%20Aug%2010%2C%202025%2C%2012_07_42%20AM.png" alt="Front"/>
              <input id="pFront" type="file" accept="image/*" capture="environment" onchange="KDR.readImage(this, 'prevFront')">
              <span>Front</span>
            </div>
            <div class="ph" onclick="document.getElementById('pBack').click()">
              <img id="prevBack" src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/Screenshot_20250827-140949.png" alt="Back"/>
              <input id="pBack" type="file" accept="image/*" capture="environment" onchange="KDR.readImage(this, 'prevBack')">
              <span>Back</span>
            </div>
            <div class="ph" onclick="document.getElementById('pAlt1').click()">
              <img id="prevAlt1" src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/1000043471-removebg-preview.png" alt="Alt1"/>
              <input id="pAlt1" type="file" accept="image/*" capture="environment" onchange="KDR.readImage(this, 'prevAlt1')">
              <span>Alt 1</span>
            </div>
            <div class="ph" onclick="document.getElementById('pAlt2').click()">
              <img id="prevAlt2" src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/ChatGPT%20Image%20Aug%2010%2C%202025%2C%2012_07_42%20AM.png" alt="Alt2"/>
              <input id="pAlt2" type="file" accept="image/*" capture="environment" onchange="KDR.readImage(this, 'prevAlt2')">
              <span>Alt 2</span>
            </div>
          </div>

          <label>Description<textarea id="pDesc" rows="3" placeholder="Grade, condition, notesâ€¦"></textarea></label>
          <button class="btn primary" type="submit">Save Product</button>
        </form>

        <div class="admin-card">
          <h3>Inventory</h3>
          <div id="adminList"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="kitty" class="kitty">
    <img id="kittyImg" src="https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/Screenshot_20250827-140949.png" alt="Kitty"/>
    <div id="kittyMsg" class="bubble">Added to cart!</div>
  </div>

  <script>
    const CDN = {
      LOGO: "https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/ChatGPT%20Image%20Aug%2010%2C%202025%2C%2012_07_42%20AM.png",
      ZOMBIE: "https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/Screenshot_20250827-140949.png",
      CHIBI: "https://raw.githubusercontent.com/KornDog0804/korndog-records-site/main/1000043471-removebg-preview.png"
    };
    
    const TAX_RATE = 0.06;
    const DISCOUNT_LADDER = [
      {threshold: 50, percent: 5},
      {threshold: 100, percent: 10},
      {threshold: 200, percent: 15}
    ];
    
    const KDR = {products: [], cart: [], filterKey: 'all', editId: null, taps: 0, tapTimer: null};
    
    const $ = (s, c = document) => c.querySelector(s);
    const fmt = n => '$' + (Math.round(n * 100) / 100).toFixed(2);
    
    KDR.snapPrice = i => {
      let v = parseFloat(i.value || 0);
      if (isNaN(v)) return;
      const c = Math.round((v - Math.floor(v)) * 100);
      const w = Math.floor(v);
      const s = Math.abs(c - 59) < Math.abs(c - 99);
      i.value = (w + (s ? .59 : .99)).toFixed(2);
    };
    
    KDR.readImage = (inp, id) => {
      const f = inp.files && inp.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = e => $('#' + id).src = e.target.result;
      r.readAsDataURL(f);
    };
    
    KDR.show = id => {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    };
    
    // Admin access
    (() => {
      const a = document.getElementById('zombieTapArea');
      if (!a) return;
      a.addEventListener('click', () => {
        KDR.taps++;
        if (!KDR.tapTimer) KDR.tapTimer = setTimeout(() => {KDR.taps = 0; KDR.tapTimer = null;}, 8000);
        if (KDR.taps >= 5) {
          KDR.taps = 0;
          clearTimeout(KDR.tapTimer);
          KDR.tapTimer = null;
          KDR.showAdmin();
        }
      });
    })();
    
    KDR.showAdmin = () => {$('#admin').classList.add('show'); KDR.renderAdmin();};
    KDR.hideAdmin = () => $('#admin').classList.remove('show');
    
    function loadProducts() {
      try {
        KDR.products = JSON.parse(localStorage.getItem('kdr_products') || '[]');
      } catch (e) {
        KDR.products = [];
      }
      
      if (!Array.isArray(KDR.products) || KDR.products.length === 0) {
        KDR.products = [
          {id: crypto.randomUUID(), title: 'Mystery Vinyl', type: 'vinyl', price: 15.99, imgFront: CDN.ZOMBIE, imgBack: CDN.LOGO, desc: 'Surprise pull - guaranteed heat'},
          {id: crypto.randomUUID(), title: 'Eddie Van Halen', type: 'funko', price: 25.99, imgFront: CDN.CHIBI, imgBack: CDN.LOGO, desc: 'Guitar legend collectible'},
          {id: crypto.randomUUID(), title: 'Aerosmith - Get a Grip', type: 'cd', price: 5.99, imgFront: CDN.LOGO, imgBack: CDN.ZOMBIE, desc: 'Classic rock essential'}
        ];
        saveProducts();
      }
    }
    
    function saveProducts() {localStorage.setItem('kdr_products', JSON.stringify(KDR.products));}
    
    KDR.saveProduct = e => {
      e.preventDefault();
      const title = $('#pTitle').value.trim(), type = $('#pType').value, price = parseFloat($('#pPrice').value || 0), desc = $('#pDesc').value.trim();
      const imgFront = $('#prevFront').src, imgBack = $('#prevBack').src, alt1 = $('#prevAlt1').src, alt2 = $('#prevAlt2').src;
      if (!title || !type || !price) return;
      
      const payload = {id: KDR.editId || crypto.randomUUID(), title, type, price, desc, imgFront, imgBack, alt1, alt2};
      if (KDR.editId) {
        const i = KDR.products.findIndex(p => p.id === KDR.editId);
        if (i > -1) KDR.products[i] = payload;
      } else {
        KDR.products.unshift(payload);
      }
      KDR.editId = null; saveProducts(); KDR.render(); KDR.renderAdmin(); e.target.reset();
      $('#prevFront').src = CDN.LOGO; $('#prevBack').src = CDN.ZOMBIE; $('#prevAlt1').src = CDN.CHIBI; $('#prevAlt2').src = CDN.LOGO;
    };
    
    KDR.deleteProduct = id => {KDR.products = KDR.products.filter(p => p.id !== id); saveProducts(); KDR.render(); KDR.renderAdmin();};
    KDR.editProduct = id => {
      const p = KDR.products.find(x => x.id === id); if (!p) return; KDR.editId = id;
      $('#pTitle').value = p.title; $('#pType').value = p.type; $('#pPrice').value = p.price.toFixed(2); $('#pDesc').value = p.desc || '';
      $('#prevFront').src = p.imgFront || CDN.LOGO; $('#prevBack').src = p.imgBack || CDN.ZOMBIE; $('#prevAlt1').src = p.alt1 || CDN.CHIBI; $('#prevAlt2').src = p.alt2 || CDN.LOGO;
      window.scrollTo({top: 0, behavior: 'smooth'});
    };
    
    KDR.filter = (k, btn) => {
      KDR.filterKey = k;
      document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');
      else document.querySelector(`.tab[data-filter="${k}"]`)?.classList.add('active');
      KDR.render();
    };
    
    KDR.render = () => {
      const grid = $('#grid'); grid.innerHTML = '';
      const list = KDR.filterKey === 'all' ? KDR.products : KDR.products.filter(p => p.type === KDR.filterKey);
      if (list.length === 0) {grid.innerHTML = '<div class="card pad">No items yet.</div>'; return;}
      list.forEach(p => {
        const el = document.createElement('div'); el.className = 'card';
        el.innerHTML = `<img src="${p.imgFront || CDN.LOGO}" alt="${p.title}"/><div class="pad"><div class="item-title">${p.title}</div><div class="price">${fmt(p.price)}</div><div class="row"><button class="btn" onclick="KDR.view('${p.id}')">View</button><button class="btn primary" onclick="KDR.add('${p.id}')">Add</button></div></div>`;
        grid.appendChild(el);
      });
    };
    
    KDR.view = id => {const p = KDR.products.find(x => x.id === id); if (!p) return; alert(`${p.title}\n\n${p.desc || ''}`)};
    
    function loadCart() {try {KDR.cart = JSON.parse(localStorage.getItem('kdr_cart') || '[]');} catch (e) {KDR.cart = []} updateCount();}
    function saveCart() {localStorage.setItem('kdr_cart', JSON.stringify(KDR.cart)); updateCount();}
    function updateCount() {$('#cartCount').textContent = KDR.cart.reduce((a, c) => a + (c.qty || 1), 0);}
    
    KDR.add = id => {
      const p = KDR.products.find(x => x.id === id); if (!p) return;
      const i = KDR.cart.findIndex(c => c.id === id);
      if (i > -1) KDR.cart[i].qty += 1;
      else KDR.cart.push({id, title: p.title, price: p.price, img: p.imgFront, qty: 1});
      saveCart(); KDR.renderCart(); KDR.openCart(); KDR.toast('add', p.type);
    };
    
    KDR.remove = i => {KDR.cart.splice(i, 1); saveCart(); KDR.renderCart(); KDR.toast('remove', 'vinyl');};
    KDR.clearCart = () => {KDR.cart = []; saveCart(); KDR.renderCart();};
    KDR.openCart = () => $('.drawer').classList.add('open');
    KDR.closeCart = () => $('.drawer').classList.remove('open');
    
    KDR.renderCart = () => {
      const list = $('#cartList'); list.innerHTML = ''; let subtotal = 0;
      KDR.cart.forEach((ci, i) => {
        subtotal += ci.price * ci.qty;
        const row = document.createElement('div'); row.className = 'cart-item';
        row.innerHTML = `<img src="${ci.img || CDN.LOGO}" alt="${ci.title}"/><div class='grow'><div><strong>${ci.title}</strong></div><div class='small'>${ci.qty} Ã— $${ci.price.toFixed(2)}</div></div><button class='btn' onclick='KDR.remove(${i})'>Remove</button>`;
        list.appendChild(row);
      });
      
      let discount = 0;
      for (const rung of DISCOUNT_LADDER) {
        if (subtotal >= rung.threshold) discount = Math.max(discount, subtotal * (rung.percent / 100));
      }
      const taxedBase = Math.max(0, subtotal - discount);
      const tax = taxedBase * TAX_RATE;
      const grand = taxedBase + tax;
      
      $('#subtotal').textContent = fmt(subtotal); $('#discount').textContent = '-' + fmt(discount);
      $('#tax').textContent = fmt(tax); $('#grand').textContent = fmt(grand);
      
      const pp = document.getElementById('paypal-buttons'); pp.innerHTML = '';
      if (KDR.cart.length > 0 && window.paypal) {
        try {
          paypal.Buttons({
            style: {layout: 'vertical', color: 'gold', shape: 'pill', label: 'paypal'},
            createOrder: (data, actions) => actions.order.create({
              purchase_units: [{
                amount: {value: grand.toFixed(2), currency_code: 'USD', breakdown: {item_total: {value: taxedBase.toFixed(2), currency_code: 'USD'}, tax_total: {value: tax.toFixed(2), currency_code: 'USD'}, discount: {value: discount.toFixed(2), currency_code: 'USD'}}},
                items: KDR.cart.map(ci => ({name: ci.title, quantity: ci.qty, unit_amount: {value: ci.price.toFixed(2), currency_code: 'USD'}}))
              }]
            }),
            onApprove: (data, actions) => actions.order.capture().then(details => {alert('Thanks, ' + (details?.payer?.name?.given_name || 'friend') + '!'); KDR.clearCart(); KDR.closeCart();}),
            onError: (err) => {console.error(err); alert('PayPal error.');}
          }).render('#paypal-buttons');
        } catch (e) {console.error('PayPal render failed:', e);}
      }
    };
    
    KDR.renderAdmin = () => {
      const list = $('#adminList'); list.innerHTML = '';
      KDR.products.forEach(p => {
        const row = document.createElement('div'); row.className = 'row';
        row.innerHTML = `<div class='grow'><strong>${p.title}</strong><br><span class='small'>${p.type} â€¢ ${fmt(p.price)}</span></div><button class='btn' onclick='KDR.editProduct("${p.id}")'>Edit</button><button class='btn' onclick='KDR.deleteProduct("${p.id}")'>Del</button>`;
        list.appendChild(row);
      });
    };
    
    KDR.toast = (action, type) => {
      const kitty = $('#kitty'), msg = $('#kittyMsg'), img = $('#kittyImg');
      if (action === 'add') {msg.textContent = 'Added to cart!'; img.src = type === 'vinyl' ? CDN.ZOMBIE : CDN.CHIBI;}
      else {msg.textContent = 'Removed!'; img.src = CDN.ZOMBIE;}
      kitty.classList.add('show');
      setTimeout(() => kitty.classList.remove('show'), 2000);
    };
    
    document.addEventListener('DOMContentLoaded', () => {loadProducts(); loadCart(); KDR.render();});
  </script>
</body>
</html>
